{"version":3,"file":"static/js/970.f42cb752.chunk.js","mappings":"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","sources":["components/ConsultationAI.jsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport logoWhite from \"../img/Recurso 2.png\";\n\nconst WEBHOOK_URL = \"https://raffo123.app.n8n.cloud/webhook/chat/orlando\";\n\nexport default function ConsultationAI() {\n  const rootRef = useRef(null);\n  const messagesEndRef = useRef(null);\n  const [messages, setMessages] = useState([\n    {\n      id: \"welcome\",\n      sender: \"bot\",\n      text: \"¡Hola! Soy el asistente del Dr. Orlando. ¿En qué puedo ayudarte hoy?\",\n    },\n  ]);\n  const [input, setInput] = useState(\"\");\n  const [isSending, setIsSending] = useState(false);\n\n  useEffect(() => {\n    const root = rootRef.current;\n    if (!root || !(\"IntersectionObserver\" in window)) return;\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((e) => {\n          if (e.isIntersecting) {\n            e.target.classList.add(\"is-inview\");\n            observer.disconnect();\n          }\n        });\n      },\n      { threshold: 0.1 }\n    );\n    observer.observe(root);\n    return () => observer.disconnect();\n  }, []);\n\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\", block: \"end\" });\n    }\n  }, [messages]);\n\n  const extractText = (obj) => {\n    if (typeof obj === \"string\") return obj;\n    if (!obj) return null;\n    const keys = [\"reply\", \"respuesta\", \"text\", \"message\", \"output\", \"response\", \"content\"];\n    for (const key of keys) {\n      if (obj[key]) {\n        if (typeof obj[key] === \"string\") return obj[key];\n        if (typeof obj[key] === \"object\") {\n          const nested = extractText(obj[key]);\n          if (nested) return nested;\n        }\n      }\n    }\n    for (const val of Object.values(obj)) {\n      if (typeof val === \"string\") return val;\n      if (typeof val === \"object\" && val !== null) {\n        const nested = extractText(val);\n        if (nested) return nested;\n      }\n    }\n    return null;\n  };\n\n  const sendMessage = async () => {\n    const message = input.trim();\n    if (!message || isSending) return;\n\n    const typingId = `typing-${Date.now()}`;\n    setMessages((prev) => [\n      ...prev,\n      { id: `user-${Date.now()}`, sender: \"user\", text: message },\n      { id: typingId, sender: \"typing\", text: \"Orlando-Agent está escribiendo...\" },\n    ]);\n    setInput(\"\");\n    setIsSending(true);\n\n    try {\n      const response = await fetch(WEBHOOK_URL, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ message }),\n      });\n      let data = await response.json();\n      if (Array.isArray(data)) data = data[0];\n\n      let botReply = extractText(data);\n      if (!botReply) {\n        botReply = \"El asistente no devolvió una respuesta de texto. Revisa la configuración de n8n.\";\n      }\n\n      setMessages((prev) => [\n        ...prev.filter((item) => item.id !== typingId),\n        { id: `bot-${Date.now()}`, sender: \"bot\", text: botReply },\n      ]);\n    } catch (error) {\n      console.error(\"Fetch Error:\", error);\n      setMessages((prev) => [\n        ...prev.filter((item) => item.id !== typingId),\n        { id: `bot-${Date.now()}`, sender: \"bot\", text: \"Lo siento, no pude conectar con el servidor de n8n.\" },\n      ]);\n    } finally {\n      setIsSending(false);\n    }\n  };\n\n  return (\n    <section\n      ref={rootRef}\n      id=\"consulta-ia\"\n      className=\"section ai-consult reveal-fade\"\n      style={{ paddingTop: \"8rem\", paddingBottom: \"4rem\" }}\n    >\n      <div className=\"container\" style={{ maxWidth: 980 }}>\n        <header style={{ textAlign: \"center\", marginBottom: \"2rem\" }}>\n          <h1 className=\"h2\" style={{ fontSize: \"clamp(2rem, 4.5vw, 3.25rem)\" }}>\n            Asistente Virtual\n          </h1>\n          <p className=\"lead\" style={{ maxWidth: 600, margin: \"12px auto 0\" }}>\n            Nuestro asistente inteligente está listo para responder sus dudas sobre procedimientos y agendamiento.\n          </p>\n        </header>\n\n        <div className=\"ai-chat-embed\">\n          <div className=\"ai-chat-card\">\n            <div className=\"ai-chat-header\">\n              <div className=\"ai-chat-avatar\" aria-hidden=\"true\">\n                <img src={logoWhite} alt=\"\" />\n              </div>\n              <div>\n                <div className=\"ai-chat-title\">Orlando-Agent</div>\n                <div className=\"ai-chat-subtitle\">Asistente de Estética</div>\n              </div>\n            </div>\n\n            <div className=\"ai-chat-messages\">\n              {messages.map((msg) => (\n                <div key={msg.id} className={`ai-chat-message ${msg.sender}`}>\n                  {msg.text}\n                </div>\n              ))}\n              <div ref={messagesEndRef} />\n            </div>\n\n            <form\n              className=\"ai-chat-input\"\n              onSubmit={(e) => {\n                e.preventDefault();\n                sendMessage();\n              }}\n            >\n              <input\n                type=\"text\"\n                className=\"ai-chat-input-field\"\n                value={input}\n                onChange={(e) => setInput(e.target.value)}\n                placeholder=\"Escribe tu mensaje...\"\n              />\n              <button type=\"submit\" className=\"ai-chat-send\" disabled={!input.trim() || isSending}>\n                Enviar\n              </button>\n            </form>\n          </div>\n        </div>\n\n        <div className=\"ai-chat-mobile surface rounded-xl shadow\">\n          <div style={{ marginBottom: \"1.5rem\" }}>\n            <div className=\"ai-chat-avatar ai-chat-avatar--lg\" aria-hidden=\"true\">\n              <img src={logoWhite} alt=\"\" />\n            </div>\n            <h3 className=\"h3\">¡Hola! Soy tu asistente</h3>\n            <p className=\"muted\" style={{ marginTop: \"0.5rem\" }}>\n              Toca la burbuja de chat en la esquina inferior derecha para conversar conmigo.\n            </p>\n          </div>\n\n          <button\n            onClick={() => window.toggleN8nChat && window.toggleN8nChat(true)}\n            className=\"btn btn--primary ai-btn\"\n            style={{ borderRadius: \"999px\" }}\n          >\n            Abrir chat ahora\n          </button>\n        </div>\n      </div>\n    </section>\n  );\n}\n"],"names":["WEBHOOK_URL","ConsultationAI","rootRef","useRef","messagesEndRef","messages","setMessages","useState","id","sender","text","input","setInput","isSending","setIsSending","useEffect","root","current","window","observer","IntersectionObserver","entries","forEach","e","isIntersecting","target","classList","add","disconnect","threshold","observe","scrollIntoView","behavior","block","extractText","obj","keys","key","nested","val","Object","values","_jsx","ref","className","style","paddingTop","paddingBottom","children","_jsxs","maxWidth","textAlign","marginBottom","fontSize","margin","src","logoWhite","alt","map","msg","concat","onSubmit","preventDefault","async","message","trim","typingId","Date","now","prev","response","fetch","method","headers","body","JSON","stringify","data","json","Array","isArray","botReply","filter","item","error","console","sendMessage","type","value","onChange","placeholder","disabled","marginTop","onClick","toggleN8nChat","borderRadius"],"sourceRoot":""}